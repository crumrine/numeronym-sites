---
import BaseLayout from '@shared/components/BaseLayout.astro';
import SiteHeader from '@shared/components/SiteHeader.astro';
import SiteFooter from '@shared/components/SiteFooter.astro';
import { getCollection } from 'astro:content';

const hallucinations = await getCollection('hallucinations');

const categoryLabels: Record<string, string> = {
  fake_history: 'Fake History',
  people_who_dont_exist: "People Who Don't Exist",
  confident_math: 'Confident Math',
  citation_needed: 'Citation Needed',
  geographic_confusion: 'Geographic Confusion',
  creative_interpretation: 'Creative Interpretation',
};

const categoryColors: Record<string, string> = {
  fake_history: '#ef4444',
  people_who_dont_exist: '#8b5cf6',
  confident_math: '#06b6d4',
  citation_needed: '#f97316',
  geographic_confusion: '#22c55e',
  creative_interpretation: '#ec4899',
};

const sorted = hallucinations.sort((a, b) => {
  const goldA = a.data.absurdity_rating * a.data.confidence_rating;
  const goldB = b.data.absurdity_rating * b.data.confidence_rating;
  return goldB - goldA;
});

const categories = Object.keys(categoryLabels);
---

<BaseLayout
  title="Hall of Fame â€” h11n.dev"
  description="A curated collection of AI's most spectacular hallucinations, rated by absurdity and confidence."
  site="h11n"
>
  <SiteHeader site="h11n" nav={[{ label: 'Hall of Fame', href: '/hall-of-fame' }, { label: 'Leaderboard', href: '/hall-of-fame/leaderboard' }, { label: 'Quiz', href: '/quiz' }, { label: 'Experiments', href: '/experiments' }]} />

  <main>
    <section class="gallery-hero">
      <div class="container text-center">
        <h1 class="gallery-title fade-up">Hall of Fame</h1>
        <p class="gallery-subtitle fade-up fade-up-delay-1">
          The finest collection of confidently wrong AI outputs, curated for your education and entertainment.
        </p>
      </div>
    </section>

    <section class="section">
      <div class="container">
        <!-- Filter buttons -->
        <div class="filter-bar fade-up fade-up-delay-2">
          <button class="filter-btn active" data-category="all">All</button>
          {categories.map((cat) => (
            <button
              class="filter-btn"
              data-category={cat}
              style={`--cat-color: ${categoryColors[cat]}`}
            >
              {categoryLabels[cat]}
            </button>
          ))}
        </div>

        <!-- Sort buttons -->
        <div class="sort-bar fade-up fade-up-delay-2">
          <span class="sort-label">Sort:</span>
          <button class="sort-btn active" data-sort="gold">Comedy Gold</button>
          <button class="sort-btn" data-sort="absurdity">Absurdity</button>
          <button class="sort-btn" data-sort="date">Date</button>
        </div>

        <!-- Card grid -->
        <div class="exhibit-grid" id="exhibit-grid">
          {sorted.map((entry) => {
            const gold = entry.data.absurdity_rating * entry.data.confidence_rating;
            const preview = entry.data.response.length > 100
              ? entry.data.response.slice(0, 100) + '...'
              : entry.data.response;
            return (
              <a
                href={`/hall-of-fame/${entry.id}`}
                class="exhibit-card fade-up"
                data-category={entry.data.category}
                data-gold={gold}
                data-absurdity={entry.data.absurdity_rating}
                data-date={entry.data.date_captured.toISOString()}
              >
                <div class="exhibit-header">
                  <span class="category-tag" style={`--cat-color: ${categoryColors[entry.data.category]}`}>
                    {categoryLabels[entry.data.category]}
                  </span>
                  <span class="gold-badge">{gold} pts</span>
                </div>
                <h3 class="exhibit-title">{entry.data.title}</h3>
                <p class="exhibit-preview">{preview}</p>
                <div class="exhibit-footer">
                  <span class="model-badge">{entry.data.model}</span>
                  <span class="exhibit-meta">
                    Absurdity: {entry.data.absurdity_rating}/10 &middot; Confidence: {entry.data.confidence_rating}/10
                  </span>
                </div>
              </a>
            );
          })}
        </div>
      </div>
    </section>
  </main>

  <SiteFooter site="h11n" extra="Accuracy of this website: not guaranteed" />
</BaseLayout>

<script>
  // Category filtering
  const filterBtns = document.querySelectorAll('.filter-btn');
  const sortBtns = document.querySelectorAll('.sort-btn');
  const grid = document.getElementById('exhibit-grid');

  if (grid) {
    filterBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        filterBtns.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
        const category = (btn as HTMLElement).dataset.category;
        const cards = grid.querySelectorAll('.exhibit-card');
        cards.forEach((card) => {
          const el = card as HTMLElement;
          if (category === 'all' || el.dataset.category === category) {
            el.style.display = '';
          } else {
            el.style.display = 'none';
          }
        });
      });
    });

    // Sorting
    sortBtns.forEach((btn) => {
      btn.addEventListener('click', () => {
        sortBtns.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
        const sortKey = (btn as HTMLElement).dataset.sort;
        const cards = Array.from(grid.querySelectorAll('.exhibit-card')) as HTMLElement[];
        cards.sort((a, b) => {
          if (sortKey === 'gold') {
            return Number(b.dataset.gold) - Number(a.dataset.gold);
          } else if (sortKey === 'absurdity') {
            return Number(b.dataset.absurdity) - Number(a.dataset.absurdity);
          } else {
            return new Date(b.dataset.date!).getTime() - new Date(a.dataset.date!).getTime();
          }
        });
        cards.forEach((card) => grid.appendChild(card));
      });
    });
  }
</script>

<style>
  .gallery-hero {
    padding: var(--space-xl) 0 var(--space-lg);
  }

  .gallery-title {
    font-size: var(--text-5xl);
    margin-bottom: var(--space-md);
  }

  .gallery-subtitle {
    font-size: var(--text-lg);
    color: var(--text-secondary);
    max-width: 50ch;
    margin: 0 auto;
  }

  .filter-bar {
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-sm);
    margin-bottom: var(--space-md);
    justify-content: center;
  }

  .filter-btn {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    padding: var(--space-xs) var(--space-md);
    border: 1px solid var(--border);
    border-radius: var(--radius-lg);
    background: transparent;
    color: var(--text-secondary);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .filter-btn:hover {
    border-color: var(--cat-color, var(--accent));
    color: var(--cat-color, var(--accent));
  }

  .filter-btn.active {
    background: var(--cat-color, var(--accent));
    border-color: var(--cat-color, var(--accent));
    color: var(--bg-primary);
  }

  .sort-bar {
    display: flex;
    align-items: center;
    gap: var(--space-sm);
    margin-bottom: var(--space-xl);
    justify-content: center;
  }

  .sort-label {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .sort-btn {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    padding: var(--space-xs) var(--space-sm);
    border: 1px solid var(--border);
    border-radius: var(--radius-sm);
    background: transparent;
    color: var(--text-muted);
    cursor: pointer;
    transition: all var(--transition-fast);
  }

  .sort-btn:hover {
    color: var(--text-secondary);
    border-color: var(--text-secondary);
  }

  .sort-btn.active {
    background: var(--bg-card);
    border-color: var(--accent);
    color: var(--accent);
  }

  .exhibit-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
    gap: var(--space-lg);
  }

  .exhibit-card {
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    border: 1px solid var(--border);
    border-left: 3px solid var(--accent);
    border-radius: var(--radius-md);
    padding: var(--space-lg);
    text-decoration: none;
    transition: border-color var(--transition-base), box-shadow var(--transition-base), transform var(--transition-base);
  }

  .exhibit-card:hover {
    border-color: var(--accent);
    box-shadow: 0 0 20px var(--accent-dim), 0 0 40px var(--accent-dim);
    transform: translateY(-2px);
    opacity: 1;
  }

  .exhibit-card:hover .exhibit-title {
    animation: glitch 0.3s ease;
  }

  .exhibit-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-sm);
  }

  .category-tag {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    padding: 2px 8px;
    border-radius: var(--radius-lg);
    background: color-mix(in srgb, var(--cat-color) 20%, transparent);
    color: var(--cat-color);
    text-transform: uppercase;
    letter-spacing: 0.04em;
    font-weight: 600;
  }

  .gold-badge {
    font-family: var(--font-mono);
    font-size: var(--text-xs);
    font-weight: 700;
    padding: 2px 10px;
    border-radius: var(--radius-sm);
    background: var(--accent);
    color: var(--bg-primary);
  }

  .exhibit-title {
    font-size: var(--text-xl);
    color: var(--text-primary);
    margin-bottom: var(--space-sm);
    font-family: var(--font-mono);
    line-height: 1.3;
  }

  .exhibit-preview {
    font-size: var(--text-sm);
    color: var(--text-secondary);
    line-height: 1.6;
    flex: 1;
    margin-bottom: var(--space-md);
  }

  .exhibit-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--space-xs);
  }

  .model-badge {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    padding: 2px 8px;
    border-radius: var(--radius-sm);
    border: 1px solid var(--border);
    color: var(--text-muted);
  }

  .exhibit-meta {
    font-family: var(--font-mono);
    font-size: 0.65rem;
    color: var(--text-muted);
  }

  @keyframes glitch {
    0%, 100% { transform: translate(0); }
    20% { transform: translate(-2px, 1px); }
    40% { transform: translate(2px, -1px); }
    60% { transform: translate(-1px, -1px); }
    80% { transform: translate(1px, 1px); }
  }

  @media (max-width: 768px) {
    .exhibit-grid {
      grid-template-columns: 1fr;
    }

    .gallery-title {
      font-size: var(--text-4xl);
    }

    .filter-bar {
      gap: 4px;
    }

    .filter-btn {
      font-size: 0.65rem;
      padding: 2px 8px;
    }
  }

  @media (min-width: 769px) and (max-width: 1024px) {
    .exhibit-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }
</style>
