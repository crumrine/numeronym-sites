---
import { getCollection, render } from 'astro:content';
import BlogPost from '../../layouts/BlogPost.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);

const ogUrl = new URL(`/blog/${post.id}`, Astro.site).href;
---

<BlogPost
  title={post.data.title}
  date={post.data.date}
  description={post.data.description}
  tags={post.data.tags}
  author={post.data.author}
>
  <Fragment slot="head">
    <!-- Open Graph -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content={post.data.title} />
    <meta property="og:description" content={post.data.description} />
    <meta property="og:url" content={ogUrl} />
    <meta property="og:site_name" content="p8s.dev" />
    <meta property="article:published_time" content={post.data.date.toISOString()} />
    {post.data.tags.map((tag) => (
      <meta property="article:tag" content={tag} />
    ))}

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content={post.data.title} />
    <meta name="twitter:description" content={post.data.description} />
  </Fragment>

  <Content />
</BlogPost>
